<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Drag and Drop</title>
    <script type="text/javascript">
    //     window.onload = function(){

    // 	let lists = document.getElementById("a");
    //     console.log(lists);
    // }
    </script>
</head>

<body>
    <div id="wrapper">
        <div id="a" class="conteiner">
            <div class="target" draggable="true">рома</div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <button id='button'>Добавить поле</button>
        </div>
        <div class="conteiner">
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
            <div class="target" draggable="true"></div>
        </div>
        <div id="trash">
        </div>
    </div>
</body>
<script>
let bodyStr = localStorage.getItem('body');
if (bodyStr !== null) {
    let bodyStr = localStorage.getItem('body');
    let body = JSON.parse(bodyStr);
    document.body.innerHTML = body;
}

let button = document.getElementById('button');
button.onclick = createNewChild;
let trash = document.getElementById('trash');
trash.addEventListener('dragover', trashFunc, false);
let cont = document.getElementsByClassName('conteiner');
let clas = document.getElementsByClassName('target');
for (let i = 0; i < clas.length; i++) {
    clas[i].addEventListener('dragstart', dragStart, false);
    clas[i].addEventListener('dragend', dragEnd, false);

}
for (let i = 0; i < cont.length; i++) {
    cont[i].addEventListener('dragenter', dragEnter, false);
    cont[i].addEventListener('dragleave', dragLeave, false);
    cont[i].addEventListener('dragover', dragOver, false);
    cont[i].addEventListener('drop', drop, false);
}

function dragStart(e) {

    this.id = 'drag';
    this.style.border = "3px dotted #000";
    e.dataTransfer.effectAllowed = "move";
    e.dataTransfer.setData("Text", this.id);

}

function dragEnd() {

    this.style.border = "";
}

function dragEnter() {

    // this.style.border = "3px solid red";
}

function dragLeave() {

    this.style.border = "";
}
// отмена стандартного обработчкика
function dragOver(e) {
    e.preventDefault();
    this.style.border = "3px solid red";
    if (e.preventDefault) e.preventDefault();
    return false;
}

function drop(e) {
    if (e.preventDefault) e.preventDefault();
    if (e.stopPropagation) e.stopPropagation();
    this.style.border = "";
    let id = e.dataTransfer.getData("Text");
    console.log(id);
    let elem = document.getElementById(id);
    console.log(elem);
    this.insertBefore(elem, this.firstChild);
    elem.id = '';
    let children = this.children;
    for (let i = 0; i < children.length; i++) {
        children[i].style.border = '';
    }
    let body = JSON.stringify(document.body.innerHTML);
    localStorage.setItem('body', body);
    return false;
}

function trashFunc(e) {
    console.log('in');
    let id = e.dataTransfer.getData("Text");
    console.log(id);
    let elem = document.getElementById(id);
    console.log(elem);

}

function createNewChild() {
    let list = document.getElementById('a');
    let item = document.createElement("div");
    item.className = 'target';
    item.draggable = true;
    item.innerText = 'make by me'
    list.insertBefore(item, list.firstChild);
    let cont = document.getElementsByClassName('conteiner');
    let clas = document.getElementsByClassName('target');
    for (let i = 0; i < clas.length; i++) {
        clas[i].addEventListener('dragstart', dragStart, false);
        clas[i].addEventListener('dragend', dragEnd, false);
        clas[i].addEventListener('dragover', dragOverChild, false);


    }
    for (let i = 0; i < cont.length; i++) {
        cont[i].addEventListener('dragenter', dragEnter, false);
        cont[i].addEventListener('dragleave', dragLeave, false);
        cont[i].addEventListener('dragover', dragOver, false);
        cont[i].addEventListener('drop', drop, false);
    }

    return
}
</script>

</html>